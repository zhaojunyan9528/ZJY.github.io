---
title: 日常随记
tags:
  - 前端
categories:
  - - 笔记
    - Javascript
date: 2023-11-03 09:49:54
---

## 2023-11-03

### /sockjs-node/info?t=${时间戳}

当运行npm run dev启动项目后，在浏览器的network中会自动持续发送`/sockjs-node/info?t=${时间戳}`请求。

sockjs-node是什么？
sockjs-node是一个JavaScript库，提供跨浏览器的API，创建了一个低延迟、全双工的浏览器和web服务器之间的通道。
在项目运行后，会已知调用该接口。
SockJS是一个JavaScript库。提供类似于websocket的对象。其作用就是在开发环境下，保证我们在改完代码重写编译后，能够通知浏览器重新加载变更结果。

这里理解为这个库用来让浏览器和本地之间热更新通信的。

如果两个地址对接不上，或者更换wifi等都会报错：sockjs-node/info?t= net::ERR_CONNECTION_TIMED_OUT

需要关闭该请求可以找到node_modules/sockjs-client/dist/sockjs.js ，注释代码的第1603行： 

```js
  try {
    // self.xhr.send(payload); 注释掉该行
  } catch (e) {
    self.emit('finish', 0, '');
    self._cleanup(false);
  }
```

以上只在本地有效，重新安装依赖或者别的同事都需要重新修改，可添加脚本，当npm install后替换掉node_modules/sockjs-client/dist/sockjs.js该文件

1.在根目录下新建该文件lib/sockjs.js,拷贝node_modules/sockjs-client/dist/sockjs.js文件并注释掉1603行

2.在根目录下创建installSockjs.js文件，将node_modules对应文件替换为lib/sockjs.js文件

3.在package.json的scripts中添加脚本命令：

```json
"scripts": {
  ...
  "postinstall: node installSockjs.js"
}
```

4.最后npm install即可，但是这样作热更新没有了。

### postinstall干什么的？？？


postinstall是安装完某个包后自动执行的脚本。可以在package.json添加postinstall设置执行的脚本命令，帮我们做一些额外的处理，例如复制文件、创建目录、执行脚本、打印信息等。

例如：将 dist 目录下的所有文件复制到 public 目录下。

```json
"scripts:" {
  "postinstall": "cp -r dist/* public/"
}
```

### 数组扩展运算符

数组的扩展运算符可以将一个数组转为用逗号分隔的参数序列，且每次只能展开一层数组。
