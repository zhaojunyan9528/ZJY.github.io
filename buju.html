<!DOCTYPE html>
<html lang="en" manifest="demo.appcache">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="buju.css">
</head>
<body>
  <div class="flex_row">triangle
    <div class="triangle"></div>

    <div class="triangle t_left"></div>
    <div class="triangle t_right"></div>
    
    <div class="triangle t_top"></div>
    <div class="triangle t_bottom"></div>
    
    <div class="triangle t_left_b"></div>
    <div class="triangle t_left_t"></div>
    <div class="triangle t_right_b"></div>
    <div class="triangle t_right_t"></div>
  </div>
  <br />
  label：利用label"模拟"button来解决不同浏览器原生button样式不同的问题
  <input type="button" id="btn">
  <label for="btn">Button</label>
  <br />
  <label for='idName' >姓名</label>
  <input type='text' id='idName' />
  <br />
  <form>
    <label for="male">Male</label>
    <input type="radio" name="sex" id="male" />
  </form>
  <br />

  <button onclick="handleClick">点击fetch</button>
  <input type="text" accesskey="n" dir="rtl" draggable="true" 
    tabindex="1" title="input" data-id="test">
  <button>hahhah</button>
  <textarea name="" id="textarea" cols="30" rows="10" style="position: absolute;z-index: -99;"></textarea>
  <input type="text">
  <img src="https://img1.baidu.com/it/u=3155988012,1977937542&fm=253&app=138&size=w931&n=0&f=JPG&fmt=auto?sec=1666890000&t=99430b88a8153ac95a1bd7fcfc8ff518" alt="" style="width: 20px;">
  <i>hahah</i>
  <em>em</em>
  <strong>strong</strong>
  <br />
  <label for="">label</label>
  <span>span</span>
  <canvas style="border: 1px solid;"></canvas>
  <audio src="https://img1.baidu.com/it/u=3155988012,1977937542&fm=253&app=138&size=w931&n=0&f=JPG&fmt=auto?sec=1666890000&t=99430b88a8153ac95a1bd7fcfc8ff518" controls>11</audio>
  <video src="https://img1.baidu.com/it/u=3155988012,1977937542&fm=253&app=138&size=w931&n=0&f=JPG&fmt=auto?sec=1666890000&t=99430b88a8153ac95a1bd7fcfc8ff518"></video>
  <table>
    <thead>
      <th>th1</th>
      <th>th2</th>
      <th>th3</th>
    </thead>
    <tbody>
      <tr>
        <td>td1</td>
        <td>td2</td>
        <td>td3</td>
      </tr>
    </tbody>
  </table>
  <div id="status"></div>
  <div class="container">
    <div class="main">
      <p>圣杯布局</p>
      <p>hahahhaha</p>
    </div>
    <div class="left">left</div>
    <div class="right">right</div>
  </div>
  <div class="container1">
    <div class="main1">
      <div class="content">
        <p>双飞翼布局</p>
        <p>hahahhaha</p>
      </div>
    </div>
    <div class="left1">left1</div>
    <div class="right1">right1</div>
  </div>

  <div class="container2">
    <div class="left2">left2</div>
    <div class="main2">
      flex
    </div>
    <div class="right2">right2</div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    function handleClick(e) {
      console.log(e);
    }
    window.onload = function() {
      // console.log(CryptoJS.enc.Base64.stringify)
      // let target = 'abc'
      // let secrect =  CryptoJS.enc.Base64.parse(target);
      // let sec = CryptoJS.enc.Base64.stringify(secrect)
      // console.log(secrect,sec)

      let str = CryptoJS.enc.Utf8.parse("Hello World!")
      var base64 = CryptoJS.enc.Base64.stringify(str)
      console.log('CryptoJS-base64---加密:',base64)

      var words = CryptoJS.enc.Base64.parse(base64);
      var parseStr = words.toString(CryptoJS.enc.Utf8)
      console.log('CryptoJS-base64---解密:', parseStr)

      //---- service work
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(
          '/servicework.js',
          {
            scope: '/'
          }
        ).then(function(reg) {
          console.log('Registration succeeded. Scope is ' + reg.scope);
        }).catch(function(error) {
          console.log('Registration failed with ' + error);
        })
      }
    }
    this.addEventListener('install', function(event) {
      event.waitUntil(
        caches.open('v1').then(function(cache) {
          return cache.addAll([
            '/buju.css',
            'buju.html'
          ])
        })
      )
    })
    this.addEventListener('fetch', function(event) {
      event.respondWith(
        caches.match(event.request).then(function (response) {
          // 如果没有在缓存中找到匹配的资源，你可以告诉浏览器对着资源直接去 fetch 默认的网络请求
          return response || fetch(event.request).then(function (resp) {
            return caches.open('v1').then(function (cache) {
              cache.put(event.request, resp.clone())
              return resp
            })
          })
          // 这里我们用 fetch(event.request) 返回了默认的网络请求，它返回了一个 promise。
          // 当网络请求的 promise 成功的时候，我们 通过执行一个函数用 caches.open('v1') 来抓取我们
          // 的缓存，它也返回了一个 promise。当这个 promise 成功的时候， cache.put() 被用来把这些
          // 资源加入缓存中。资源是从 event.request 抓取的，它的响应会被 response.clone() 克隆一份
          // 然后被加入缓存。这个克隆被放到缓存中，它的原始响应则会返回给浏览器来给调用它的页面。
        }).catch(function () {
          return caches.match('/fallback.html')
        })
        // 当请求没有匹配到请求的资源网络也不可用时，请求会失败，提供一个回退方案
      )
    })

    // web sql start
    var dbase = openDatabase('mydb', '1.0', 'Test DB', 2 * 1024 * 1024);
    dbase.transaction(function (tx) {
      tx.executeSql('CREATE TABLE IF NOT EXISTS WIN (id unique, name)');
      tx.executeSql('INSERT INTO WIN (id, name) VALUES (1, "winty")');
      tx.executeSql('INSERT INTO WIN (id, name) VALUES (2, "LuckyWinty")');
    })
    dbase.transaction(function (tx) {
      tx.executeSql('SELECT * FROM WIN', [], function (tx, results) {
          var len = results.rows.length, i;
          msg = "<p>查询记录条数: " + len + "</p>";
          document.querySelector('#status').innerHTML +=  msg;

          for (i = 0; i < len; i++){
            console.log(results.rows.item(i).name );
          }

      }, null);
    })
    // web sql end

    // indexedDB---start
    {
      let dbName = 'helloIndexedDB', version = 1, storeName = 'helloStore'
      let indexedDB = window.indexedDB
      let db
      const request = indexedDB.open(dbName, version)
      request.onsuccess = function (event) {
        db = event.target.result // 数据库对象
        console.log('数据库打开成功')
      }
      request.onerror = function (event) {
        console.log('数据库打开报错')
      }
      // 数据库创建或升级时触发
      request.onupgradeneeded = function (event) {
        console.log('onupgradeneeded')
        db = event.target.result // 数据库对象
        let objStore
        if (!db.objectStoreNames.contains(storeName)) {
          objStore = db.createObjectStore(storeName, {keyPath: 'id'})
        }
      }
      // 添加数据
      function addData(db, storeName, data) {
        let request = db.transaction([storeName], 'readwrite')
          .objectStore(storeName) // 仓库对象
          .add(data)
        request.onsuccess = function(event) {
          console.log('数据写入成功')
        }
        request.onerror = function(event) {
          console.log('数据写入失败')
          throw new Error(event.target.error)
        }
      }

      // 根据id获取数据
      function getDataBykey(db, storeName, key) {
        let req = db.transaction([storeName]).objectStore(storeName).get(key)
        req.onsuccess = function (event) {
          console.log('查询结果', req.result)
        }
        req.onerror = function (event) {
          console.log('查询失败')
        }
      }

      // 根据id修改数据
      function updateDB(db, storeName, data) {
        let req = db.transaction([storeName], 'readwrite')
          .objectStore(storeName)
          .put(data)
        req.onsuccess = function (event) {
          console.log('数据更新成功')
        }
        req.onerror = function (event) {
          console.log('数据更新失败')
        }
      }

      // 根据id删除数据
      function deleteBD(db, storeName, id) {
        let req = db.transaction([storeName], 'readwrite')
          .objectStore(storeName)
          .delete(id)
        req.onsuccess = function (event) {
          console.log('数据删除成功')
        }
        req.onerror = function (event) {
          console.log('数据删除失败')
        }
      }

      // 由于打开indexDB是异步的加个定时器避免 db对象还没获取到值导致 报错
      setTimeout(() => {
        addData(db, storeName, {
          id: 1,
          name: 'zhangsan',
          age: 18,
          desc: 'a girl'
        })

        getDataBykey(db, storeName, 1)

        updateDB(db, storeName, {id: 1, desc: 'a boy'})

        // deleteBD(db, storeName, 1)
      }, 1000)
    }
  </script>
  <script>
    // 创建Base64对象
    var Base64 = {
     _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
     encode: function(e) {
      var t = "";
      var n, r, i, s, o, u, a;
      var f = 0;
      e = Base64._utf8_encode(e);
      while (f < e.length) {
       n = e.charCodeAt(f++);
       r = e.charCodeAt(f++);
       i = e.charCodeAt(f++);
       s = n >> 2;
       o = (n & 3) << 4 | r >> 4;
       u = (r & 15) << 2 | i >> 6;
       a = i & 63;
       if (isNaN(r)) {
        u = a = 64
       } else if (isNaN(i)) {
        a = 64
       }
       t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
      }
      return t
     },
     decode: function(e) {
      var t = "";
      var n, r, i;
      var s, o, u, a;
      var f = 0;
      e=e.replace(/[^A-Za-z0-9+/=]/g,"");
      while (f < e.length) {
       s = this._keyStr.indexOf(e.charAt(f++));
       o = this._keyStr.indexOf(e.charAt(f++));
       u = this._keyStr.indexOf(e.charAt(f++));
       a = this._keyStr.indexOf(e.charAt(f++));
       n = s << 2 | o >> 4;
       r = (o & 15) << 4 | u >> 2;
       i = (u & 3) << 6 | a;
       t = t + String.fromCharCode(n);
       if (u != 64) {
        t = t + String.fromCharCode(r)
       }
       if (a != 64) {
        t = t + String.fromCharCode(i)
       }
      }
      t = Base64._utf8_decode(t);
      return t
     },
     _utf8_encode: function(e) {
      e = e.replace(/rn/g, "n");
      var t = "";
      for (var n = 0; n < e.length; n++) {
       var r = e.charCodeAt(n);
       if (r < 128) {
        t += String.fromCharCode(r)
       } else if (r > 127 && r < 2048) {
        t += String.fromCharCode(r >> 6 | 192);
        t += String.fromCharCode(r & 63 | 128)
       } else {
        t += String.fromCharCode(r >> 12 | 224);
        t += String.fromCharCode(r >> 6 & 63 | 128);
        t += String.fromCharCode(r & 63 | 128)
       }
      }
      return t
     },
     _utf8_decode: function(e) {
      var t = "";
      var n = 0;
      var r = c1 = c2 = 0;
      while (n < e.length) {
       r = e.charCodeAt(n);
       if (r < 128) {
        t += String.fromCharCode(r);
        n++
       } else if (r > 191 && r < 224) {
        c2 = e.charCodeAt(n + 1);
        t += String.fromCharCode((r & 31) << 6 | c2 & 63);
        n += 2
       } else {
        c2 = e.charCodeAt(n + 1);
        c3 = e.charCodeAt(n + 2);
        t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
        n += 3
       }
      }
      return t
     }
    }
    // 定义字符串
    var string = 'Hello World!';
    // 加密
    var encodedString = Base64.encode(string);
    console.log('base64加密', encodedString); // 输出: "SGVsbG8gV29ybGQh"
    // 解密
    var decodedString = Base64.decode(encodedString);
    console.log('base64解密', decodedString); // 输出: "Hello World!"
  </script>
</body>
</html>